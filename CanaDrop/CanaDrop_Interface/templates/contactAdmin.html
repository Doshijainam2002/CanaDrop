<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contact Admin - CanaDrop</title>
    <link rel="icon" href="https://i.postimg.cc/c4jt62GM/Website-Logo-No-Background.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .glass-card {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .floating-label {
            transform: translateY(-50%);
            transition: all 0.3s ease;
        }
        .input-focused .floating-label {
            transform: translateY(-100%);
            font-size: 0.75rem;
            color: #667eea;
        }
        .custom-shadow {
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.08), 0 0 0 1px rgba(0, 0, 0, 0.05);
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.4);
        }
        .back-btn {
            transition: all 0.3s ease;
        }
        .back-btn:hover {
            transform: translateX(-4px);
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50">
    <!-- Decorative Background Elements -->
    <div class="fixed inset-0 overflow-hidden pointer-events-none">
        <div class="absolute -top-40 -right-40 w-80 h-80 rounded-full bg-gradient-to-r from-blue-400/20 to-purple-400/20 blur-3xl"></div>
        <div class="absolute -bottom-40 -left-40 w-80 h-80 rounded-full bg-gradient-to-r from-indigo-400/20 to-cyan-400/20 blur-3xl"></div>
    </div>

    <div class="relative max-w-4xl mx-auto px-4 py-12">
        <!-- Header Section -->
        <div class="text-center mb-12">
            <button onclick="goBack()" class="back-btn inline-flex items-center text-gray-600 hover:text-indigo-600 font-medium mb-8 group">
                <div class="p-2 rounded-full bg-white/60 backdrop-blur-sm border border-white/20 mr-3 group-hover:bg-indigo-50">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                    </svg>
                </div>
                Back to Dashboard
            </button>
            
            <div class="max-w-2xl mx-auto">
                <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-4 tracking-tight">
                    Get in <span class="gradient-bg bg-clip-text text-transparent">Touch</span>
                </h1>
                <p class="text-lg text-gray-600 leading-relaxed">
                    Have a question or need assistance? We're here to help. Send us a message and our support team will get back to you promptly.
                </p>
            </div>
        </div>

        <!-- Contact Form Card -->
        <div class="max-w-2xl mx-auto">
            <div class="glass-card custom-shadow rounded-3xl p-8 md:p-12">
                <!-- User Info Banner -->
                <div id="userInfoBanner" class="hidden mb-8 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-2xl border border-blue-100">
                    <div class="flex items-center">
                        <div class="p-2 bg-blue-100 rounded-full mr-3">
                            <svg id="userIcon" class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                            </svg>
                        </div>
                        <div>
                            <p class="text-sm font-medium text-blue-900">Contacting as</p>
                            <p id="userTypeText" class="text-blue-700 font-semibold"></p>
                        </div>
                    </div>
                </div>

                <form id="contactForm" class="space-y-8">
                    <!-- Subject Selection -->
                    <div class="relative">
                        <label for="subject" class="block text-sm font-semibold text-gray-800 mb-3">
                            What can we help you with? <span class="text-red-500">*</span>
                        </label>
                        <select id="subject" name="subject" required class="w-full p-4 bg-white border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all duration-300 text-gray-700 font-medium">
                            <option value="">Choose a category...</option>
                            <optgroup label="🔐 Account & Authentication">
                                <option value="account_creation">Account Creation Issue</option>
                                <option value="login_problem">Login / Authentication Problem</option>
                                <option value="password_reset">Password Reset Issue</option>
                                <option value="profile_update">Profile / Information Update</option>
                            </optgroup>
                            <optgroup label="📦 Order Management">
                                <option value="order_placement">Order Placement Issue</option>
                                <option value="order_cancellation">Order Cancellation Issue</option>
                                <option value="order_tracking">Order Tracking / Status</option>
                                <option value="order_payment">Order Payment / Rate Issue</option>
                            </optgroup>
                            <optgroup label="🚚 Delivery Services">
                                <option value="pickup_issue">Pickup Issue by Driver</option>
                                <option value="delivery_delay">Delivery Delay</option>
                                <option value="delivery_incorrect">Incorrect Delivery / Item Issue</option>
                                <option value="driver_unavailable">Driver Unavailable / Assignment</option>
                            </optgroup>
                            <optgroup label="💳 Billing & Payments">
                                <option value="invoice_generated">Invoice Generated Issue</option>
                                <option value="invoice_payment">Invoice Payment / Stripe Issue</option>
                                <option value="driver_invoice">Driver Invoice / Payment Issue</option>
                            </optgroup>
                            <optgroup label="⚙️ Technical Support">
                                <option value="technical_bug">Technical / App Bug</option>
                                <option value="cloud_storage">Cloud / Image Upload Issue</option>
                                <option value="notification">Notification / Alert Issue</option>
                            </optgroup>
                            <optgroup label="💬 General">
                                <option value="feedback">Feedback / Suggestion</option>
                                <option value="other">Other</option>
                            </optgroup>
                        </select>
                    </div>

                    <!-- Other Subject Field -->
                    <div id="otherSubjectField" class="hidden">
                        <label for="otherSubject" class="block text-sm font-semibold text-gray-800 mb-3">
                            Please specify your subject <span class="text-red-500">*</span>
                        </label>
                        <input 
                            type="text" 
                            id="otherSubject" 
                            name="otherSubject" 
                            maxlength="255"
                            placeholder="Enter your specific subject..."
                            class="w-full p-4 bg-white border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all duration-300 font-medium"
                        >
                    </div>

                    <!-- Message Field -->
                    <div class="relative">
                        <label for="message" class="block text-sm font-semibold text-gray-800 mb-3">
                            Tell us more about your issue <span class="text-red-500">*</span>
                        </label>
                        <textarea 
                            id="message" 
                            name="message" 
                            required 
                            rows="6"
                            placeholder="Please provide detailed information about your issue or inquiry. The more details you provide, the better we can assist you..."
                            class="w-full p-4 bg-white border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all duration-300 resize-vertical font-medium"
                        ></textarea>
                        <div class="flex justify-between items-center mt-2">
                            <p class="text-sm text-gray-500">Please be as detailed as possible for faster resolution</p>
                            <div class="flex items-center text-xs text-gray-400">
                                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
                                </svg>
                                Secure & confidential
                            </div>
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <div class="pt-4">
                        <button 
                            type="submit" 
                            id="submitBtn"
                            class="btn-primary w-full text-white font-semibold py-4 px-8 rounded-xl transition-all duration-300 focus:ring-4 focus:ring-indigo-500/20 focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"
                        >
                            <span id="submitText" class="flex items-center justify-center">
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
                                </svg>
                                Send Message
                            </span>
                            <span id="submitSpinner" class="hidden flex items-center justify-center">
                                <div class="animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-3"></div>
                                Sending your message...
                            </span>
                        </button>
                    </div>
                </form>

                <!-- Support Info -->
                <div class="mt-8 pt-8 border-t border-gray-200">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-center">
                        <div class="flex flex-col items-center">
                            <div class="p-3 bg-green-100 rounded-full mb-3">
                                <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                            </div>
                            <h3 class="font-semibold text-gray-800 mb-1">Quick Response</h3>
                            <p class="text-sm text-gray-600">We typically respond within 24 hours</p>
                        </div>
                        <div class="flex flex-col items-center">
                            <div class="p-3 bg-blue-100 rounded-full mb-3">
                                <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 5.636l-3.536 3.536m0 5.656l3.536 3.536M9.172 9.172L5.636 5.636m3.536 9.192L5.636 18.364M12 2.25a9.75 9.75 0 100 19.5 9.75 9.75 0 000-19.5z"/>
                                </svg>
                            </div>
                            <h3 class="font-semibold text-gray-800 mb-1">Expert Support</h3>
                            <p class="text-sm text-gray-600">Dedicated team ready to help</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Premium Success/Error Modal -->
    <div id="responseModal" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
        <div class="glass-card custom-shadow max-w-md w-full mx-4 rounded-3xl overflow-hidden transform transition-all">
            <div class="p-8 text-center">
                <!-- Success State -->
                <div id="successState" class="hidden">
                    <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-green-100 mb-6">
                        <svg class="h-8 w-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-900 mb-3">Message Sent!</h3>
                    <p class="text-gray-600 mb-8 leading-relaxed">Thank you for reaching out. Our support team has received your message and will get back to you within 24 hours.</p>
                </div>
                
                <!-- Error State -->
                <div id="errorState" class="hidden">
                    <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-red-100 mb-6">
                        <svg class="h-8 w-8 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-900 mb-3">Something went wrong</h3>
                    <p id="errorMessage" class="text-gray-600 mb-8 leading-relaxed">We couldn't send your message. Please try again.</p>
                </div>
                
                <button id="modalCloseBtn" class="btn-primary w-full text-white font-semibold py-3 px-6 rounded-xl transition-all duration-300">
                    Continue
                </button>
            </div>
        </div>
    </div>

    <script>
        // Get cookie function
        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
            return null;
        }

        // Get CSRF token
        function getCSRFToken() {
            return getCookie('csrftoken');
        }

        // Initialize user identification
        function initializeUser() {
            const pharmacyId = getCookie('pharmacyId');
            const driverId = getCookie('driverId');
            const userBanner = document.getElementById('userInfoBanner');
            const userTypeText = document.getElementById('userTypeText');
            const userIcon = document.getElementById('userIcon');
            
            if (pharmacyId) {
                userBanner.classList.remove('hidden');
                userTypeText.textContent = 'Pharmacy Partner';
                userIcon.innerHTML = `
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                `;
                return { type: 'pharmacy', id: pharmacyId };
            } else if (driverId) {
                userBanner.classList.remove('hidden');
                userTypeText.textContent = 'Delivery Driver';
                userIcon.innerHTML = `
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                `;
                return { type: 'driver', id: driverId };
            }
            
            return null;
        }

        // Show/hide other subject field
        document.getElementById('subject').addEventListener('change', function() {
            const otherField = document.getElementById('otherSubjectField');
            const otherInput = document.getElementById('otherSubject');
            
            if (this.value === 'other') {
                otherField.classList.remove('hidden');
                otherInput.required = true;
            } else {
                otherField.classList.add('hidden');
                otherInput.required = false;
                otherInput.value = '';
            }
        });

        // Form submission
        document.getElementById('contactForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const user = initializeUser();
            if (!user) {
                showModal(false, 'Please log in to send a message. You must be logged in as either a pharmacy or driver.');
                return;
            }
            
            const submitBtn = document.getElementById('submitBtn');
            const submitText = document.getElementById('submitText');
            const submitSpinner = document.getElementById('submitSpinner');
            
            // Show loading state
            submitBtn.disabled = true;
            submitText.classList.add('hidden');
            submitSpinner.classList.remove('hidden');
            
            try {
                // Collect form data
                const formData = new FormData(this);
                
                // Create JSON payload
                const payload = {
                    subject: formData.get('subject'),
                    message: formData.get('message'),
                    otherSubject: formData.get('otherSubject') || ''
                };
                
                // Add user identification
                if (user.type === 'pharmacy') {
                    payload.pharmacy_id = user.id;
                } else {
                    payload.driver_id = user.id;
                }
                
                const response = await fetch('/api/contact-admin/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCSRFToken() || ''
                    },
                    body: JSON.stringify(payload)
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showModal(true, data.message || 'Thank you for contacting us. We\'ll get back to you as soon as possible.');
                    // Reset form on success
                    this.reset();
                    document.getElementById('otherSubjectField').classList.add('hidden');
                    document.getElementById('otherSubject').required = false;
                } else {
                    showModal(false, data.error || 'Failed to send message. Please try again.');
                }
                
            } catch (error) {
                console.error('Error:', error);
                showModal(false, 'Unable to send message. Please check your connection and try again.');
            } finally {
                submitBtn.disabled = false;
                submitText.classList.remove('hidden');
                submitSpinner.classList.add('hidden');
            }
        });

        // Show modal function
        function showModal(isSuccess, message) {
            const modal = document.getElementById('responseModal');
            const successState = document.getElementById('successState');
            const errorState = document.getElementById('errorState');
            const errorMessage = document.getElementById('errorMessage');
            
            if (isSuccess) {
                successState.classList.remove('hidden');
                errorState.classList.add('hidden');
            } else {
                successState.classList.add('hidden');
                errorState.classList.remove('hidden');
                errorMessage.textContent = message;
            }
            
            modal.classList.remove('hidden');
        }

        // Close modal and redirect
        document.getElementById('modalCloseBtn').addEventListener('click', function() {
            document.getElementById('responseModal').classList.add('hidden');
            setTimeout(() => {
                window.location.href = '/';
            }, 100);
        });

        // Back button function
        function goBack() {
            window.location.href = '/';
        }

        // Close modal when clicking outside
        document.getElementById('responseModal').addEventListener('click', function(e) {
            if (e.target === this) {
                document.getElementById('modalCloseBtn').click();
            }
        });

        // Close modal with Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                const modal = document.getElementById('responseModal');
                if (!modal.classList.contains('hidden')) {
                    document.getElementById('modalCloseBtn').click();
                }
            }
        });

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            initializeUser();
        });
    </script>
</body>
</html>