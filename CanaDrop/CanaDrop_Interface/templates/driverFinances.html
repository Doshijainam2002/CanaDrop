<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Driver Finances - CanaDrop</title>
    <link rel="icon" href="https://i.postimg.cc/c4jt62GM/Website-Logo-No-Background.png">
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-gradient-to-br from-slate-900 to-gray-900">
    <!-- Sidebar -->
    <div class="fixed inset-y-0 left-0 z-50 w-64 bg-slate-800 border-r border-slate-700">
        <div class="flex items-center justify-center h-16 px-4 border-b border-slate-700">
            <img src="https://i.postimg.cc/c4jt62GM/Website-Logo-No-Background.png" alt="CanaDrop Logo" class="h-8 w-auto">
            <span class="ml-2 text-xl font-bold text-slate-100">CanaDrop</span>
        </div>
        
        <nav class="mt-8">
            <a href="/driverDashboard/" class="nav-item flex items-center px-6 py-3 text-slate-300 hover:bg-slate-700 hover:text-emerald-400 transition-colors">
                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"/>
                </svg>
                Dashboard
            </a>
            <a href="/driverAcceptedDeliveries/" class="nav-item flex items-center px-6 py-3 text-slate-300 hover:bg-slate-700 hover:text-emerald-400 transition-colors">
                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8l6 6 10-10"/>
                </svg>
                Accepted Deliveries
            </a>
            <a href="/driverFinances/" class="nav-item active bg-slate-700 text-emerald-400 flex items-center px-6 py-3 transition-colors">
                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"/>
                </svg>
                Finances
            </a>
            <a href="#" onclick="handleLogout()" class="nav-item flex items-center px-6 py-3 text-slate-300 hover:bg-slate-700 hover:text-red-400 transition-colors mt-8">
                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
                </svg>
                Logout
            </a>
        </nav>
    </div>

    <!-- Main Content -->
    <div class="ml-64">
        <!-- Header -->
        <header class="bg-slate-800 border-b border-slate-700 px-6 py-4">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-2xl font-bold text-slate-100">Finances</h1>
                    <p class="text-slate-400 text-sm">Manage your earnings and payment summaries</p>
                </div>
                <div class="flex items-center space-x-4">
                    <span class="text-slate-300" id="welcomeText">Welcome back, Driver!</span>
                    <div class="w-8 h-8 bg-emerald-500 rounded-full flex items-center justify-center">
                        <span class="text-white font-semibold" id="profileInitial">D</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="p-6">
            <!-- Stats Grid -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="bg-slate-800 border border-slate-700 rounded-lg p-6 hover:border-emerald-500 transition-colors">
                    <div class="flex items-center">
                        <div class="p-2 bg-blue-500 bg-opacity-20 rounded-lg">
                            <svg class="w-6 h-6 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2"/>
                            </svg>
                        </div>
                        <div class="ml-4">
                            <p class="text-slate-400 text-sm">Total Summaries</p>
                            <p class="text-2xl font-bold text-slate-100" id="totalSummaries">1</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-slate-800 border border-slate-700 rounded-lg p-6 hover:border-emerald-500 transition-colors">
                    <div class="flex items-center">
                        <div class="p-2 bg-yellow-500 bg-opacity-20 rounded-lg">
                            <svg class="w-6 h-6 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                        </div>
                        <div class="ml-4">
                            <p class="text-slate-400 text-sm">Generated</p>
                            <p class="text-2xl font-bold text-slate-100" id="generatedSummaries">1</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-slate-800 border border-slate-700 rounded-lg p-6 hover:border-emerald-500 transition-colors">
                    <div class="flex items-center">
                        <div class="p-2 bg-green-500 bg-opacity-20 rounded-lg">
                            <svg class="w-6 h-6 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                            </svg>
                        </div>
                        <div class="ml-4">
                            <p class="text-slate-400 text-sm">Paid</p>
                            <p class="text-2xl font-bold text-slate-100" id="paidSummaries">0</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-slate-800 border border-slate-700 rounded-lg p-6 hover:border-emerald-500 transition-colors">
                    <div class="flex items-center">
                        <div class="p-2 bg-emerald-500 bg-opacity-20 rounded-lg">
                            <svg class="w-6 h-6 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"/>
                            </svg>
                        </div>
                        <div class="ml-4">
                            <p class="text-slate-400 text-sm">Outstanding</p>
                            <p class="text-2xl font-bold text-slate-100" id="totalOutstanding">$345.00</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Payment Summaries Table -->
            <div class="bg-slate-800 border border-slate-700 rounded-lg">
                <div class="px-6 py-4 border-b border-slate-700">
                    <div class="flex items-center justify-between">
                        <h2 class="text-lg font-semibold text-slate-100">Payment Summaries</h2>
                        <select id="statusFilter" onchange="renderSummaries()" 
                                class="bg-slate-700 border border-slate-600 text-slate-200 rounded-lg px-3 py-1 text-sm focus:ring-2 focus:ring-emerald-500 focus:border-transparent">
                            <option value="all">All Status</option>
                            <option value="generated">Generated</option>
                            <option value="paid">Paid</option>
                        </select>
                    </div>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-slate-700">
                            <tr>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-slate-300 uppercase">Summary ID</th>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-slate-300 uppercase">Payment Period</th>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-slate-300 uppercase">Orders</th>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-slate-300 uppercase">Amount</th>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-slate-300 uppercase">Due Date</th>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-slate-300 uppercase">Status</th>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-slate-300 uppercase">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="summariesTable" class="divide-y divide-slate-700">
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <script>
        let summaries = [
            {
                id: 1,
                startDate: "2025-01-01",
                endDate: "2025-01-07",
                totalDeliveries: 15,
                totalAmount: 345.00,
                dueDate: "2025-01-15",
                status: "generated",
                pdfUrl: null
            }
        ];

        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
            return null;
        }

        function getStatusBadge(status) {
            const config = {
                'generated': { class: 'bg-yellow-500 bg-opacity-20 text-yellow-300 border border-yellow-500', label: 'Generated' },
                'paid': { class: 'bg-green-500 bg-opacity-20 text-green-300 border border-green-500', label: 'Paid' }
            };
            const { class: className, label } = config[status];
            return `<span class="inline-flex px-3 py-1 text-xs font-medium rounded-full ${className}">${label}</span>`;
        }

        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString('en-US', {
                month: 'short', day: 'numeric', year: 'numeric'
            });
        }

        function renderSummaries() {
            const tbody = document.getElementById('summariesTable');
            const filter = document.getElementById('statusFilter').value;
            
            let filteredSummaries = filter === 'all' ? summaries : summaries.filter(s => s.status === filter);
            
            if (filteredSummaries.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="px-6 py-12 text-center">
                            <svg class="w-12 h-12 text-slate-500 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 4H7a2 2 0 01-2-2V6a2 2 0 012-2h7l5 5v9a2 2 0 01-2 2z"/>
                            </svg>
                            <h3 class="text-lg font-medium text-slate-300 mb-1">No summaries found</h3>
                            <p class="text-slate-500">No payment summaries match the selected criteria.</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = filteredSummaries.map(summary => `
                <tr class="hover:bg-slate-700 hover:bg-opacity-50 transition-colors">
                    <td class="px-6 py-4 text-sm font-medium text-slate-200">#${String(summary.id).padStart(6, '0')}</td>
                    <td class="px-6 py-4 text-sm text-slate-300">${formatDate(summary.startDate)} - ${formatDate(summary.endDate)}</td>
                    <td class="px-6 py-4 text-sm text-slate-300">${summary.totalDeliveries}</td>
                    <td class="px-6 py-4 text-sm font-medium text-slate-200">$${summary.totalAmount.toFixed(2)}</td>
                    <td class="px-6 py-4 text-sm text-slate-300">${formatDate(summary.dueDate)}</td>
                    <td class="px-6 py-4">${getStatusBadge(summary.status)}</td>
                    <td class="px-6 py-4">
                        <button onclick="viewSummary(${summary.id})" class="text-emerald-400 hover:text-emerald-300 transition-colors p-2" title="View Summary">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                            </svg>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function viewSummary(summaryId) {
            const summary = summaries.find(s => s.id === summaryId);
            if (!summary) return;
            
            if (summary.pdfUrl) {
                window.open(summary.pdfUrl, '_blank');
            } else {
                alert('Summary document is being generated. Please check back later.');
            }
        }

        function updateStats() {
            const total = summaries.length;
            const generated = summaries.filter(s => s.status === 'generated').length;
            const paid = summaries.filter(s => s.status === 'paid').length;
            const outstanding = summaries.filter(s => s.status !== 'paid').reduce((sum, s) => sum + s.totalAmount, 0);

            document.getElementById('totalSummaries').textContent = total;
            document.getElementById('generatedSummaries').textContent = generated;
            document.getElementById('paidSummaries').textContent = paid;
            document.getElementById('totalOutstanding').textContent = '$' + outstanding.toFixed(2);
        }

        function handleLogout() {
            if (confirm('Are you sure you want to logout?')) {
                document.cookie = "driverId=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
                window.location.href = "/driverLogin/";
            }
        }

        async function loadDriverInfo() {
            try {
                const driverId = getCookie("driverId");
                if (!driverId) return;

                const response = await fetch(`/api/driver/details/?driverId=${driverId}`);
                if (!response.ok) throw new Error("Failed to fetch driver info");

                const data = await response.json();
                document.getElementById("welcomeText").textContent = `Welcome back, ${data.name}!`;
                document.getElementById("profileInitial").textContent = data.name.charAt(0).toUpperCase();
            } catch (error) {
                console.error("Error loading driver info:", error);
            }
        }

        document.addEventListener("DOMContentLoaded", function() {
            loadDriverInfo();
            renderSummaries();
            updateStats();
        });
    </script>
</body>
</html>