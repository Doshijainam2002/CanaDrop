<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CC Points - CanaLogistiX</title>
    <link rel="icon" href="https://canalogistix.s3.us-east-2.amazonaws.com/Logo/CanaLogistiX_Logo_BG.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    animation: {
                        'fade-in': 'fadeIn 0.3s ease-in-out',
                        'slide-up': 'slideUp 0.3s ease-out',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite'
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
    </style>
</head>
<body class="bg-gray-50 font-inter">
    <div class="flex h-screen overflow-hidden">

    <!-- Sidebar -->
    <aside id="sidebar" class="w-64 bg-white border-r border-gray-200 flex flex-col fixed lg:static inset-y-0 left-0 z-40 transform -translate-x-full lg:translate-x-0 transition-transform duration-300 overflow-y-auto">
        <!-- Logo -->
        <div class="flex items-center h-16 px-6 border-b border-gray-200">
            <div class="flex items-center">
                <img src="https://canalogistix.s3.us-east-2.amazonaws.com/Logo/CanaLogistiX_Logo_NOBG.png" alt="Logo" class="h-12 w-auto">
                <span class="ml-2 text-lg font-semibold text-gray-900">CanaLogistiX</span>
            </div>
        </div>

        <!-- Navigation -->
        <nav class="flex-1 px-4 py-6 space-y-2">
            <!-- Dashboard -->
            <a href="/pharmacyDashboard/" class="flex items-center px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition-colors">
                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M13 5v6h6"/>
                </svg>
                Dashboard
            </a>

            <!-- Orders -->
            <a href="/pharmacyOrders/" class="flex items-center px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition-colors">
                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v8m-6 0a2 2 0 002 2h2a2 2 0 002-2"/>
                </svg>
                Orders
            </a>

            <!-- Invoices -->
            <a href="/pharmacyInvoices/" class="flex items-center px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition-colors">
                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 4H7a2 2 0 01-2-2V6a2 2 0 012-2h7l5 5v9a2 2 0 01-2 2z"/>
                </svg>
                Invoices
            </a>

            <!-- Contact Admin -->
            <a href="/contactAdmin/" class="flex items-center px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition-colors">
                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M21 12c0 4.418-4.03 8-9 8s-9-3.582-9-8 4.03-8 9-8 9 3.582 9 8zM12 14v-4m0 4h.01"/>
                </svg>
                Contact Admin
            </a>
            
            <!-- My Profile -->
            <a href="/pharmacyProfile/" class="flex items-center px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition-colors">
                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                </svg>
                My Profile
            </a>

            <!-- CC Points (Active) -->
            <a href="/pharmacyCCPoints/" class="flex items-center px-3 py-2 text-sm font-medium text-white bg-gradient-to-r from-teal-600 to-cyan-600 rounded-lg">
                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                CC Points
            </a>

            <!-- Logout -->
            <a href="javascript:void(0);" onclick="logoutPharmacy()" 
            class="flex items-center px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition-colors">
                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                        d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h6a2 2 0 012 2v1"/>
                </svg>
                Logout
            </a>
        </nav>

        <!-- User Profile -->
        <div class="px-4 py-4 border-t border-gray-200">
            <div class="flex items-center">
                <div class="flex-shrink-0 w-8 h-8 bg-gradient-to-r from-teal-500 to-cyan-500 rounded-full flex items-center justify-center">
                    <span class="text-sm font-medium text-white" id="pharmacyInitial">P</span>
                </div>
                <div class="ml-3">
                    <p class="text-sm font-medium text-gray-900" id="pharmacyName">Pharmacy Admin</p>
                    <p class="text-xs text-gray-500" id="pharmacyEmail">admin@pharmacy.com</p>
                </div>
            </div>
        </div>
    </aside>

    <div id="sidebarOverlay" class="hidden lg:hidden fixed inset-0 bg-black/50 z-30"></div>

        <!-- Main Content -->
        <main class="flex-1 flex flex-col overflow-y-auto lg:ml-0">
            <!-- Header with CC Points Display -->
            <header class="bg-white shadow-sm border-b border-gray-200 px-4 sm:px-6 py-4">
                <div class="flex items-center justify-between gap-4">
                    <button id="menuToggle" class="lg:hidden text-gray-900 p-2 flex-shrink-0">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                        </svg>
                    </button>
                    <div class="flex-1 min-w-0">
                        <h1 class="text-xl sm:text-2xl font-bold text-gray-900">CC Points</h1>
                        <p class="text-sm text-gray-500 hidden sm:block">Your rewards & achievements</p>
                    </div>
                    <div class="flex items-center gap-3 bg-gradient-to-r from-teal-600 to-cyan-600 text-white px-4 sm:px-6 py-2 sm:py-3 rounded-xl shadow-lg">
                        <svg class="w-5 h-5 sm:w-6 sm:h-6 animate-pulse-slow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        <div>
                            <p class="text-xs sm:text-sm opacity-90">Your CC Points</p>
                            <p class="text-xl sm:text-2xl font-bold" id="headerCCPoints">0</p>
                        </div>
                    </div>
                </div>
            </header>

            <!-- CC Points Stats Section -->
            <section class="p-4 sm:p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 lg:gap-6 mb-8">
                    <!-- Total CC Points Card -->
                    <div class="bg-gradient-to-br from-teal-500 to-cyan-600 p-6 sm:p-8 rounded-2xl shadow-xl text-white transform hover:scale-105 transition-all duration-300">
                        <div class="flex items-center justify-between mb-4">
                            <div>
                                <p class="text-sm sm:text-base opacity-90">Total CC Points</p>
                                <p class="text-4xl sm:text-5xl font-bold mt-2" id="totalCCPoints">0</p>
                            </div>
                            <div class="p-4 bg-white/20 rounded-2xl backdrop-blur-sm">
                                <svg class="w-10 h-10 sm:w-12 sm:h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                            </div>
                        </div>
                        <div class="flex items-center gap-2 text-sm">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
                            </svg>
                            <span>Earn 50 points per delivery</span>
                        </div>
                    </div>

                    <!-- Delivered Orders Card -->
                    <div class="bg-white p-6 sm:p-8 rounded-2xl shadow-lg border border-gray-100 transform hover:scale-105 transition-all duration-300">
                        <div class="flex items-center justify-between mb-4">
                            <div>
                                <p class="text-sm sm:text-base text-gray-600">Completed Deliveries</p>
                                <p class="text-4xl sm:text-5xl font-bold text-gray-900 mt-2" id="deliveredOrders">0</p>
                            </div>
                            <div class="p-4 bg-green-100 rounded-2xl">
                                <svg class="w-10 h-10 sm:w-12 sm:h-12 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                                </svg>
                            </div>
                        </div>
                        <div class="flex items-center gap-2 text-sm text-gray-600">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            <span>Successfully delivered orders</span>
                        </div>
                    </div>
                </div>

                <!-- Coming Soon Section -->
                <div class="relative bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden" style="min-height: 500px;">
                    <!-- Blur Background -->
                    <div class="absolute inset-0 bg-gradient-to-br from-gray-100 via-gray-50 to-teal-50 opacity-50"></div>
                    <div class="absolute inset-0 backdrop-blur-sm"></div>
                    
                    <!-- Coming Soon Content -->
                    <div class="relative z-10 flex flex-col items-center justify-center h-full py-16 px-4">
                        <div class="text-center animate-fade-in">
                            <!-- Icon -->
                            <div class="mb-6 flex justify-center">
                                <div class="p-6 bg-gradient-to-br from-teal-500 to-cyan-600 rounded-full shadow-2xl animate-pulse-slow">
                                    <svg class="w-16 h-16 sm:w-20 sm:h-20 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"/>
                                    </svg>
                                </div>
                            </div>
                            
                            <!-- Text -->
                            <h2 class="text-3xl sm:text-4xl lg:text-5xl font-bold text-gray-900 mb-4">
                                Coming Soon
                            </h2>
                            <p class="text-base sm:text-lg text-gray-600 mb-6 max-w-md mx-auto">
                                We're working on exciting new features for CC Points. Stay tuned!
                            </p>
                            
                            <!-- Features Preview -->
                            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 max-w-3xl mx-auto mt-12">
                                <div class="bg-white/60 backdrop-blur-sm p-6 rounded-xl border border-gray-200 shadow-sm">
                                    <div class="p-3 bg-teal-100 rounded-lg w-fit mx-auto mb-3">
                                        <svg class="w-6 h-6 text-teal-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v13m0-13V6a2 2 0 112 2h-2zm0 0V5.5A2.5 2.5 0 109.5 8H12zm-7 4h14M5 12a2 2 0 110-4h14a2 2 0 110 4M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/>
                                        </svg>
                                    </div>
                                    <h3 class="font-semibold text-gray-900 mb-1">Redeem Rewards</h3>
                                    <p class="text-sm text-gray-600">Convert points into exclusive benefits</p>
                                </div>
                                
                                <div class="bg-white/60 backdrop-blur-sm p-6 rounded-xl border border-gray-200 shadow-sm">
                                    <div class="p-3 bg-cyan-100 rounded-lg w-fit mx-auto mb-3">
                                        <svg class="w-6 h-6 text-cyan-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                                        </svg>
                                    </div>
                                    <h3 class="font-semibold text-gray-900 mb-1">Points History</h3>
                                    <p class="text-sm text-gray-600">Track your earning journey</p>
                                </div>
                                
                                <div class="bg-white/60 backdrop-blur-sm p-6 rounded-xl border border-gray-200 shadow-sm">
                                    <div class="p-3 bg-purple-100 rounded-lg w-fit mx-auto mb-3">
                                        <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"/>
                                        </svg>
                                    </div>
                                    <h3 class="font-semibold text-gray-900 mb-1">Bonus Challenges</h3>
                                    <p class="text-sm text-gray-600">Earn extra points with milestones</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        // Get cookie value by name
        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
            return null;
        }

        function getCSRFToken() {
    return document.cookie
        .split('; ')
        .find(row => row.startsWith('csrftoken='))
        ?.split('=')[1];
        }

        // Load CC Points data
        async function loadCCPoints() {
        try {
            const pharmacyId = getCookie("pharmacyId");
            if (!pharmacyId) {
            console.error("Pharmacy ID not found in cookies");
            return;
            }

            const response = await fetch(`/api/pharmacy/${pharmacyId}/cc-points/`, {
            method: "GET",
            headers: {
                "X-CSRFToken": getCSRFToken(),
                "Accept": "application/json"
            },
            credentials: "include" // ✅ send authToken + csrftoken cookies
            });

            if (!response.ok) {
            throw new Error("Failed to fetch CC points");
            }

            const data = await response.json();

            if (data.success) {
            // Update all CC points displays
            const ccPoints = data.cc_points;
            const deliveredOrders = data.delivered_orders;

            document.getElementById("headerCCPoints").textContent = ccPoints;
            document.getElementById("totalCCPoints").textContent = ccPoints;
            document.getElementById("deliveredOrders").textContent = deliveredOrders;
            } else {
            console.error("Failed to load CC points:", data.error);
            }
        } catch (error) {
            console.error("Error loading CC points:", error);
        }
        }


        // Load pharmacy details
        async function loadPharmacyDetails() {
            try {
                const pharmacyId = getCookie("pharmacyId");
                if (!pharmacyId) {
                    console.error("Pharmacy ID not found in cookies");
                    return;
                }

                const response = await fetch(`/pharmacy/${pharmacyId}/`);
                if (!response.ok) {
                    throw new Error("Failed to fetch pharmacy details");
                }

                const data = await response.json();
                
                if (data.success && data.pharmacy) {
                    document.getElementById('pharmacyName').textContent = data.pharmacy.name;
                    document.getElementById('pharmacyEmail').textContent = data.pharmacy.email;
                    
                    if (data.pharmacy.name) {
                        document.getElementById('pharmacyInitial').textContent = data.pharmacy.name.charAt(0).toUpperCase();
                    }
                }

            } catch (error) {
                console.error("Error loading pharmacy details:", error);
            }
        }

        // Logout function
        async function logoutPharmacy() {
        try {
            const res = await fetch("/api/pharmacy/logout/", {
            method: "POST",
            headers: {
                "X-CSRFToken": getCSRFToken(),
                "Accept": "application/json"
            },
            credentials: "include" // ✅ send HttpOnly authToken + csrftoken cookies
            });

            // If token already expired/invalid, still proceed to clear client-side cookies + redirect
            try { await res.json(); } catch (_) {}
        } catch (e) {
            console.error("Logout error:", e);
        } finally {
            // ✅ Clear client-side readable cookies (authToken is HttpOnly so JS cannot delete it)
            const cookiesToClear = ["pharmacyId", "tokenExpiresAt", "csrftoken"];
            cookiesToClear.forEach(name => {
            document.cookie = `${name}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;`;
            });

            // Redirect to pharmacy login
            window.location.href = "/pharmacyLogin/?reason=expired";
        }
        }



        // Initialize on page load
        document.addEventListener("DOMContentLoaded", function() {
            loadCCPoints();
            loadPharmacyDetails();

            // Mobile menu toggle
            const menuToggle = document.getElementById('menuToggle');
            const sidebar = document.getElementById('sidebar');
            const sidebarOverlay = document.getElementById('sidebarOverlay');

            if (menuToggle) {
                menuToggle.addEventListener('click', () => {
                    sidebar.classList.toggle('-translate-x-full');
                    sidebarOverlay.classList.toggle('hidden');
                });
            }

            if (sidebarOverlay) {
                sidebarOverlay.addEventListener('click', () => {
                    sidebar.classList.add('-translate-x-full');
                    sidebarOverlay.classList.add('hidden');
                });
            }
        });
    </script>
</body>
</html>